@layout Layout.MainLayout
@page "/product/create"
@using EccomerceBlazorWasm.Models.Product
@using EccomerceBlazorWasm.Interfaces
@using EccomerceBlazorWasm.Interfaces.PorductInterface
@using EccomerceBlazorWasm.Models.CreateModel
@using EccomerceBlazorWasm.Models.ViewModel
@using Microsoft.AspNetCore.Components.Forms

@attribute [Authorize(Roles = "admin")]

@inject EccomerceBlazorWasm.Interfaces.IR2 _r2
@inject IProduct _product
@inject IProductBrand _productBrand
@inject IProductCategory _productCategory
@inject IState _state

@inject NavigationManager _navigation
<AuthorizeView>
    <Authorized>
        <section class="bg-white dark:bg-gray-900">
            <div class="py-8 px-4 mx-auto max-w-6xl lg:py-16">
                <h2 class="mb-4 text-2xl font-bold text-blue-600 dark:text-white">Crear Producto</h2>
                <form @onsubmit="HandleSubmit">
                    <div Model="product" class="grid gap-4 sm:grid-cols-4 sm:gap-6">
                        <div class="sm:col-span-2">
                            <div class="grid gap-4 sm:grid-cols-2 sm:gap-6">
                                <div class="sm:col-span-2">
                                    <label for="name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                        Nombre del Producto <span class="text-red-600">*</span>
                                    </label>
                                    <input type="text" @bind-value="product.Name" id="name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" placeholder="Nombre del Producto" required="">
                                </div>
                                <script>
                                    function validarNumeros(input) {
                                        input.value = input.value.replace(/\D/g, '');
                                    }
                                </script>

                                <div class="w-full">
                                    <label for="code" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                        SKU <span class="text-red-600">*</span>
                                    </label>
                                    <input type="text" @bind-value="product.SKU" id="code" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" placeholder="Codigo interno" required oninput="validarNumeros(this)">
                                </div>
                                <div class="w-full">
                                    <label for="BarCode" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                        Codigo de Barras <span class="text-red-600">*</span>
                                    </label>
                                    <input type="text" @bind-value="product.BarCode" id="BarCode" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" placeholder="Codigo de Barras" required oninput="validarNumeros(this)">
                                </div>

                                <div class="w-full">
                                    <label for="date" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                        Fecha <span class="text-red-600">*</span>
                                    </label>
                                    <input type="datetime-local" @bind-value="product.Date" id="date" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" placeholder="Product brand" required="">
                                </div>
                                <div class="w-full">
                                    <label for="existence" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                        Cantidad <span class="text-red-600">*</span>
                                    </label>
                                    <input type="number" @bind-value="product.Existence" id="existence" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" placeholder="50" required min="0">
                                </div>
                                <div class="w-full">
                                    <label for="cost" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                        Precio de Coste <span class="text-red-600">*</span>
                                     </label>
                                    <input type="number" @bind-value="product.Cost" step="0.01" id="cost" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" placeholder="$2500" required="" min="0">
                                </div>
                                <div class="w-full">
                                    <label for="price" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                        Precio de venta <span class="text-red-600">*</span>
                                    </label>
                                    <input type="number" @bind-value="product.Price" step="0.01" id="price" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" placeholder="$2999" required="" min="0">
                                </div>
                                <div>
                                    <label for="category" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                        Categoria <span class="text-red-600">*</span>
                                    </label>
                                    <select @bind="product.ProductCategoryId" id="category" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                                        <option selected="">Selecciona una Categoria</option>
                                        @foreach (var category in productCategories)
                                        {
                                            <option value="@category.Id">@category.Name</option>
                                        }
                                    </select>
                                </div>
                                <div>
                                    <label for="brand" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                        Marca <span class="text-red-600">*</span>
                                    </label>
                                    <select @bind="product.ProductBrandId" id="brand" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                                        <option selected="">Selecciona una Marca</option>
                                        @foreach (var brand in productBrands)
                                        {
                                            <option value="@brand.Id">@brand.Name</option>
                                        }
                                    </select>
                                </div>
                                <div>
                                    <label for="state" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                        Estado <span class="text-red-600">*</span>
                                    </label>
                                    <select @bind="product.StateId" id="state" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                                        <option selected="">Selecciona un Estado</option>
                                        @foreach (var state in states)
                                        {
                                            <option value="@state.Id">@state.Name</option>
                                        }
                                    </select>
                                </div>
                                <div class="w-full">
                                    <label for="visible" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                        Visible para la tienda <span class="text-red-600">*</span>
                                    </label>
                                    <label class="mt-2 inline-flex items-center cursor-pointer">
                                        <span class="me-3 text-sm font-medium text-gray-900 dark:text-gray-300">NO</span>
                                        <input @bind="product.IsVisible" type="checkbox" class="sr-only peer">
                                        <div class="relative w-14 h-7 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                        <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">SI</span>
                                    </label>
                                </div>
                                <div class="sm:col-span-2">
                                    <label for="description" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Descripción</label>
                                    <textarea @bind="product.Description" id="description" rows="4" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Escriba una descripción del producto aquí"></textarea>
                                </div>
                            </div>
                        </div>
                        <!-- Detalles -->
                        <div class="sm:col-span-2">
                            <div class="grid gap-4 sm:grid-cols-3 sm:gap-6">
                                <!-- Especificaciones -->
                                <script>
                                    function validarNombreProducto(input) {
                                        input.value = input.value.replace(/[^a-zA-Z0-9\s]/g, '');
                                    }
                                    function validarLetras(input) {
                                        input.value = input.value.replace(/[^a-zA-Z\s]/g, '');
                                    }
                                    function validarNumerosYLetras(input) {
                                        let value = input.value.toUpperCase();
                                        if (!value.startsWith("IP")) {
                                            value = "IP" + value.replace(/[^0-9]/g, '');
                                        } else {
                                            value = value.replace(/[^0-9]/g, '');
                                            value = "IP" + value;
                                        }
                                        input.value = value.substring(0, 4);
                                    }
                                    function validarSensor(input) {
                                        input.value = input.value.replace(/[^a-zA-Z,\s]/g, '');
                                    }
                                    function validarBluetoothVersion(input) {
                                        input.value = input.value.replace(/[^0-9.]/g, '');
                                    }
                                    function validarRearCameraResolution(input) {
                                        input.value = input.value.replace(/[^0-9MP+\s]/g, '');
                                    }
                                </script>
                                <label class="sm:col-span-3 block border-b-4 border-gray-400  text-lg font-medium text-gray-900 dark:text-white">Especificaciones</label>
                                <div class="sm:col-span-3">
                                    <label for="model" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Modelo</label>
                                    <input type="text" @bind-value="productSpecification.ModelNumber" id="model" placeholder="Digite el modelo" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" oninput="validarNombreProducto(this)">
                                </div>
                                <div>
                                    <label for="RAM" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">RAM</label>
                                    <select @bind="productSpecification.RAM" id="RAM" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                                        <option value="">Selecciona la RAM</option>
                                        <option value="2">2 GB</option>
                                        <option value="4">4 GB</option>
                                        <option value="6">6 GB</option>
                                        <option value="8">8 GB</option>
                                        <option value="12">12 GB</option>
                                        <option value="16">16 GB</option>
                                        <option value="18">18 GB</option>
                                        <option value="20">20 GB</option>
                                        <option value="24">24 GB</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="ProcessorSpeed" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Velocidad del procesador</label>
                                    <input type="number" step="0.01" @bind-value="productSpecification.ProcessorSpeed" id="ProcessorSpeed" placeholder='6.2"' class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" min="0">
                                </div>
                                <div>
                                    <label for="InternalStorage" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Almacenamiento (GB)</label>
                                    <select @bind="productSpecification.InternalStorage" id="InternalStorage" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                                        <option value="">Selecciona el Almacenamiento</option>
                                        <option value="16">16 GB</option>
                                        <option value="32">32 GB</option>
                                        <option value="64">64 GB</option>
                                        <option value="128">128 GB</option>
                                        <option value="256">256 GB</option>
                                        <option value="512">512 GB</option>
                                        <option value="1024">1 TB</option>
                                        <option value="2048">2 TB</option>
                                    </select>
                                </div>
                                <!-- Pantalla -->
                                <label class="sm:col-span-3 block border-b-4 border-gray-400  text-lg font-medium text-gray-900 dark:text-white">Pantalla</label>
                                <div>
                                    <label for="ScreenSize" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Tamaño</label>
                                    <input type="number" step="0.01" @bind-value="productSpecification.ScreenSize" id="ScreenSize" placeholder='6.2' class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" min="0">
                                </div>
                                <div>
                                    <label for="ScreenResolution" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Resolución</label>
                                    <select @bind="productSpecification.ScreenResolution" id="ScreenResolution" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                                        <option value="">Seleccione una opción</option>
                                        <option value="720p">HD (720p)</option>
                                        <option value="1080p">FHD (1080p)</option>
                                        <option value="1440p">QHD (1440p)</option>
                                        <option value="2160p">4K (2160p)</option>
                                    </select>
                                </div>
                                <div class="w-full">
                                    <label for="ScreenTechnology" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Tecnología de Pantalla</label>
                                    <select @bind="productSpecification.ScreenTechnology" id="ScreenTechnology" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                                        <option value="">Selecciona la Tecnología</option>
                                        <option value="LCD">LCD</option>
                                        <option value="LED">LED</option>
                                        <option value="OLED">OLED</option>
                                        <option value="AMOLED">AMOLED</option>
                                        <option value="Retina">Retina</option>
                                    </select>
                                </div>

                                <!-- Cámara -->
                                <label class="sm:col-span-3 block border-b-4 border-gray-400  text-lg font-medium text-gray-900 dark:text-white">Cámara</label>

                                <div>
                                    <label for="RearCameraResolution" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Cámara trasera</label>
                                    <input type="text" @bind-value="productSpecification.RearCameraResolution" id="RearCameraResolution" placeholder="200MP + 8MP + 2MP" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" oninput="validarRearCameraResolution(this)">
                                </div>
                                <div>
                                    <label for="FrontCameraResolution" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Cámara delantera (MP)</label>
                                    <input type="number" @bind-value="productSpecification.FrontCameraResolution" id="FrontCameraResolution" placeholder="16" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" min="0">
                                </div>

                                <!-- Conectividad -->
                                <label class="sm:col-span-3 block border-b-4 border-gray-400  text-lg font-medium text-gray-900 dark:text-white">Conectividad</label>
                                <div>
                                    <label for="SimType" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Tipo de SIM trasera</label>
                                    <select @bind="productSpecification.SimType" id="SimType" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                                        <option value="">Seleccione una opción</option>
                                        <option value="SIM Estándar">SIM Estándar</option>
                                        <option value="Micro SIM">Micro SIM</option>
                                        <option value="Nano SIM">Nano SIM</option>
                                        <option value="eSIM">eSIM</option>
                                        <option value="SIM Virtual">SIM Virtual</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="SimCount" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Cantidad de tarjetas SIM</label>
                                    <select @bind="productSpecification.SimCount" id="SimCount" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                                        <option value="">Selecciona una opción</option>
                                        <option value="1">Single SIM</option>
                                        <option value="2">Dual SIM</option>
                                    </select>
                                </div>
                                <div class="w-full">
                                    <label for="NFC" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Cuenta con NFC</label>
                                    <label class="mt-2 inline-flex items-center cursor-pointer">
                                        <span class="me-3 text-sm font-medium text-gray-900 dark:text-gray-300">NO</span>
                                        <input @bind="productSpecification.NFC" id="NFC" type="checkbox" class="sr-only peer">
                                        <div class="relative w-14 h-7 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                        <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">SI</span>
                                    </label>
                                </div>
                                <div>
                                    <label for="BluetoothVersion" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Versión de Bluetooth</label>
                                    <input type="text" @bind-value="productSpecification.BluetoothVersion" id="BluetoothVersion" placeholder="5.0" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" oninput="validarBluetoothVersion(this)">
                                </div>
                                <div>
                                    <label for="UsbInterface" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Interfaz USB</label>
                                    <select @bind="productSpecification.UsbInterface" id="UsbInterface" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                                        <option value="">Seleccione una opción</option>
                                        <option value="Micro USB">Micro USB</option>
                                        <option value="USB-C">USB-C</option>
                                        <option value="Lightning">Lightning</option>
                                    </select>
                                </div>

                                <!-- Resistencia -->
                                <label class="sm:col-span-3 block border-b-4 border-gray-400  text-lg font-medium text-gray-900 dark:text-white">Resistencia</label>
                                <div class="w-full">
                                    <label for="Waterproof" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Resistencia al agua</label>
                                    <label class="mt-2 inline-flex items-center cursor-pointer">
                                        <span class="me-3 text-sm font-medium text-gray-900 dark:text-gray-300">NO</span>
                                        <input @bind="productSpecification.Waterproof" id="Waterproof" type="checkbox" class="sr-only peer">
                                        <div class="relative w-14 h-7 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                        <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">SI</span>
                                    </label>
                                </div>
                                <div>
                                    <label for="WaterResistanceRating" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Clasificación </label>
                                    <input type="text" @bind-value="productSpecification.WaterResistanceRating" id="WaterResistanceRating" placeholder="IP12" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" oninput="validarNumerosYLetras(this)">
                                </div>

                                <div class="w-full">
                                    <label for="SplashResistant" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Resistente a salpicaduras</label>
                                    <label class="mt-2 inline-flex items-center cursor-pointer">
                                        <span class="me-3 text-sm font-medium text-gray-900 dark:text-gray-300">NO</span>
                                        <input @bind="productSpecification.SplashResistant" id="SplashResistant" type="checkbox" class="sr-only peer">
                                        <div class="relative w-14 h-7 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                        <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">SI</span>
                                    </label>
                                </div>

                                <!-- Adicionales -->
                                <label class="sm:col-span-3 block border-b-4 border-gray-400  text-lg font-medium text-gray-900 dark:text-white">Otros</label>
                                <div>
                                    <label for="color" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Color</label>
                                    <input type="text" @bind-value="productSpecification.Color" id="color" placeholder="Gris" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" oninput="validarLetras(this)">
                                </div>
                                <div>
                                    <label for="Sensor" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Sensor</label>
                                    <input type="text" @bind-value="productSpecification.Sensor" id="Sensor" placeholder="..." class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" oninput="validarSensor(this)">
                                </div>
                                <div class="w-full">
                                    <label for="OperatingSystem" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Sistema Operativo</label>
                                    <select @bind="productSpecification.OperatingSystem" id="OperatingSystem" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                                        <option value="">Seleccione una opción</option>
                                        <option value="Android">Android</option>
                                        <option value="iOS">iOS</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="BatteryCapacity" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Capacidad de batería</label>
                                    <select @bind="productSpecification.BatteryCapacity" id="BatteryCapacity" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                                        <option value="">Seleccione una opción</option>
                                        <option value="3000">3000 mAh</option>
                                        <option value="3500">3500 mAh</option>
                                        <option value="4000">4000 mAh</option>
                                        <option value="4500">4500 mAh</option>
                                        <option value="5000">5000 mAh</option>
                                        <option value="5500">5500 mAh</option>
                                        <option value="6000">6000 mAh</option>
                                    </select>
                                </div>
                                <div class="sm:col-span-3">
                                    <div class="grid gap-4 sm:grid-cols-3 sm:gap-4">
                                        <div class="sm:col-span-3">
                                            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white" for="default_size">Subir Imagenes</label>
                                            @for (int i = 0; i <= currentFileSelection; i++) // Se genera un nuevo imput despues que se uso el primero u el anterior, esto para evitar el error: "There is no file with ID 1. The file list may have changed"
                                            {
                                                var e = i; // Pasar a "e" el valor de "i", parque se asi se guarde correctame el id
                                                <InputFile OnChange="HandleFileSelection" multiple id="@($"imput_file_{e}")"
                                                           class="block w-full mb-5 text-sm text-gray-900 border border-blue-300 rounded-lg cursor-pointer bg-blue-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400"
                                                           style="@(i < currentFileSelection ? "display: none;" : "")" />
                                                // Oculta a los imputFile excepto el ultimo
                                            }
                                        </div>
                                        @foreach (var imageUrl in photos)
                                        {
                                            <div class="max-w-sm bg-white border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700">

                                                <div class="relative">
                                                    <img class="object-scale-down rounded-t-lg h-300 w-252" src="@imageUrl.Url" alt="Imagenes del celular" />

                                                    <!-- Botón superpuesto -->
                                                    <button @onclick="() => RemoveImage(imageUrl.Url)" type="button" class="absolute bottom-2 left-2 px-1 py-1 text-xs font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 focus:ring-4 focus:outline-none focus:ring-red-300 dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-800">
                                                        <svg class="rtl:rotate-180 w-4 h-4  text-white-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                                                            <path fill-rule="evenodd" d="M8.586 2.586A2 2 0 0 1 10 2h4a2 2 0 0 1 2 2v2h3a1 1 0 1 1 0 2v12a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V8a1 1 0 0 1 0-2h3V4a2 2 0 0 1 .586-1.414ZM10 6h4V4h-4v2Zm1 4a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Zm4 0a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Z" clip-rule="evenodd" />
                                                        </svg>
                                                    </button>
                                                </div>
                                                <div class="p-5 flex justify-center items-center">
                                                    @if (IsMainImage(imageUrl.FileName))
                                                    {
                                                        <span class="inline-flex items-center bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-300">
                                                            <span class="w-3 h-3 me-1 bg-green-500 rounded-full"></span>
                                                            <h5 class="text-base">Principal</h5>
                                                        </span>
                                                    }
                                                    else
                                                    {
                                                        <button @onclick="() => SetAsMainImage(imageUrl.FileName)" type="button" class="inline-flex items-center px-5 py-2.5 text-sm font-medium text-center text-white bg-blue-700 rounded-lg focus:ring-4 focus:ring-blue-200 dark:focus:ring-blue-900 hover:bg-blue-800">Seleccionar</button>
                                                    }
                                                </div>
                                            </div>
                                        }

                                    </div>
                                </div>

                            </div>
                        </div>

                    </div>

                    <button type="submit" class="inline-flex items-center px-5 py-2.5 mt-4 sm:mt-6 text-sm font-medium text-center text-white bg-blue-700 rounded-lg focus:ring-4 focus:ring-blue-200 dark:focus:ring-blue-900 hover:bg-blue-800">
                        Guardar Cambios
                    </button>
                </form>

            </div>
        </section>



    </Authorized>
    <NotAuthorized>
        <RedirectToLogin />
    </NotAuthorized>
</AuthorizeView>

@code {
    private ProductCreateModel product = new ProductCreateModel();
    private ProductSpecificationViewModel productSpecification = new ProductSpecificationViewModel();
    private List<ProductBrandViewModel> productBrands = new List<ProductBrandViewModel>();
    private List<ProductCategoryViewModel> productCategories = new List<ProductCategoryViewModel>();
    private List<StateViewModel> states = new List<StateViewModel>();
    private bool isVisibleSpecification = false;

    private List<IBrowserFile> selectedFiles = new List<IBrowserFile>();
    int currentFileSelection = 0;
    private List<ProductPhotoViewModel> photos = new List<ProductPhotoViewModel>();
    private List<string> tempUrls = new List<string>(); // Lista temporal para las URLs base64
    private string? mainImageFileName;

    protected override async Task OnInitializedAsync()
    {
        productBrands = await _productBrand.GetAllAsync();
        productCategories = await _productCategory.GetAllAsync();
        states = await _state.GetAllAsync();
        product.IsVisible = true;
    }

    private async Task HandleFileSelection(InputFileChangeEventArgs e)
    {
        var maxAllowedFiles = 5;

        foreach (var file in e.GetMultipleFiles(maxAllowedFiles))
        {

            currentFileSelection++;

            var stream = file.OpenReadStream();
            using var ms = new MemoryStream();
            await stream.CopyToAsync(ms);
            var bytes = ms.ToArray();
            var base64 = Convert.ToBase64String(bytes);
            var tempUrl = $"data:{file.ContentType};base64,{base64}";

            string customFileName = $"CustomName_{currentFileSelection}{Path.GetExtension(file.Name)}{DateTime.Now:yyyyMMddHHmmssfff}";

            var photo = new ProductPhotoViewModel
                {
                    Url = tempUrl, // Usar la URL temporal por ahora
                    FileName = customFileName,
                    ProductId = 0 // El productId puede ser cero ya que la API vincula las fotos enviadas con este producto que se creará
                };

            if (photos.Count == 0)
            {
                photo.IsMain = true;
                mainImageFileName = customFileName;
            }
            else
            {
                photo.IsMain = false;
            }
            selectedFiles.Add(file); // Añade el archivo a la lista selectedFiles
            photos.Add(photo);
            tempUrls.Add(tempUrl); // Agregar la URL temporal a la lista
        }
    }

    private void RemoveImage(string imageUrl)
    {
        int index = photos.FindIndex(photo => photo.Url == imageUrl);
        if (index >= 0)
        {
            bool isMainImageBeingRemoved = photos[index].IsMain;

            photos.RemoveAt(index);
            selectedFiles.RemoveAt(index);
            tempUrls.RemoveAt(index); // Remover la URL temporal correspondiente
            currentFileSelection--;

            // Actualizar la imagen principal si se está eliminando la actual principal
            if (isMainImageBeingRemoved && photos.Count > 0)
            {
                SetNextMainImage();
            }
        }
    }

    private void SetNextMainImage()
    {
        if (photos.Count > 0)
        {
            photos[0].IsMain = true;
            mainImageFileName = photos[0].FileName;
        }
        else
        {
            mainImageFileName = null;
        }
    }

    private bool IsMainImage(string fileName)
    {
        return fileName == mainImageFileName;
    }

    private void SetAsMainImage(string fileName)
    {
        foreach (var photo in photos)
        {
            if (photo.FileName == fileName)
            {
                photo.IsMain = true;
                mainImageFileName = fileName;
            }
            else
            {
                photo.IsMain = false;
            }
        }
    }

    private async Task HandleSubmit()
    {
        try
        {
            product.Specifications = productSpecification;

            if (selectedFiles.Any())
            {
                var urls = (await _r2.UploadImagesAsync(selectedFiles)).ToList();

                // Asignar las URLs correctas a las fotos
                for (int i = 0; i < urls.Count; i++)
                {
                    photos[i].Url = urls[i];
                }
            }

            product.Photos = photos.Select(photo => new ProductPhotoViewModel
                {
                    Url = photo.Url,
                    FileName = photo.FileName,
                    IsMain = photo.IsMain,
                    ProductId = 0 // Actualiza este valor si es necesario
                }).ToList();

            var createdProduct = await _product.CreateAsync(product); // Crear el producto a través del servicio

            _navigation.NavigateTo(URLS.PRODUCT_LIST); // Redirigir al listado de los productos
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error al subir archivos: {ex.Message}");
        }
    }
}